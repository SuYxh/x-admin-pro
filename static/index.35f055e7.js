import{a1 as e,a as l,R as a,j as t,r as o,o as s,f as i,w as u,e as r,b as n,m as d,F as c,E as p,a2 as f,z as m,A as y,D as v,G as h,C as _,_ as w,c as b,g,t as V,a3 as k}from"./index.aca157f3.js";function C(){return e({url:"/classify/getAllClassify",method:"get"})}const x=l({__name:"TopicForm",props:{isEdit:{type:Boolean},classify:{type:Object}},emits:["createSuccess"],setup(l,{expose:f,emit:m}){var y;const v=l,h=a(!0),_=a(),w=t({title:"",classify_id:void 0,company:"",author:"",answer:"",mdurl:""});null==v||v.classify,null==(y=null==v?void 0:v.classify)||y.value;const b=a([]);v.classify?b.value=v.classify:(async()=>{const e=await C();b.value=e.data})();const g=t({title:[{validator:(e,l,a)=>{""===l?a(new Error("Please input the title")):(l.includes("script")&&a(new Error("包含特殊字符")),a())},trigger:"blur"}]}),V=async l=>{await function(l){return e({url:"/topic/create",method:"post",data:l})}(l);m("createSuccess")};return f({distribute:e=>{var l;h.value?p.error("请先启用编辑"):e?(l=_.value)&&l.validate((e=>{if(!e)return!1;w.title,V(w)})):(e=>{e&&e.resetFields()})(_.value)},enableEdit:()=>{h.value=!1}}),(e,l)=>{const a=o("el-input"),t=o("el-form-item"),p=o("el-option"),f=o("el-select"),m=o("el-form");return s(),i(m,{ref_key:"ruleFormRef",ref:_,model:w,"status-icon":"",rules:g,class:"formData"},{default:u((()=>[r(t,{label:"标题",prop:"title"},{default:u((()=>[r(a,{modelValue:w.title,"onUpdate:modelValue":l[0]||(l[0]=e=>w.title=e),type:"textarea",placeholder:"请输入题目",autocomplete:"off"},null,8,["modelValue"])])),_:1}),r(t,{label:"分类",prop:"classify_id"},{default:u((()=>[r(f,{modelValue:w.classify_id,"onUpdate:modelValue":l[1]||(l[1]=e=>w.classify_id=e),class:"m-2",placeholder:"请选择分类"},{default:u((()=>[(s(!0),n(c,null,d(b.value,(e=>(s(),i(p,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(t,{label:"作者",prop:"author"},{default:u((()=>[r(a,{modelValue:w.author,"onUpdate:modelValue":l[2]||(l[2]=e=>w.author=e),placeholder:"请输入题目作者",autocomplete:"off"},null,8,["modelValue"])])),_:1}),r(t,{label:"公司",prop:"company"},{default:u((()=>[r(a,{modelValue:w.company,"onUpdate:modelValue":l[3]||(l[3]=e=>w.company=e),placeholder:"请输入题目来源",autocomplete:"off"},null,8,["modelValue"])])),_:1}),r(t,{label:"答案",prop:"answer"},{default:u((()=>[r(a,{modelValue:w.answer,"onUpdate:modelValue":l[4]||(l[4]=e=>w.answer=e),placeholder:"请输入题目答案或者上传markdown文件",type:"textarea",autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])}}}),E={class:"drawer-wrap"},T={class:"drawer-header"},U=(e=>(v("data-v-3a51de7d"),e=e(),h(),e))((()=>m("h4",null,"TopicPanel",-1))),z=_("开启编辑"),F={style:{flex:"auto"}},j=_("关闭"),A=_("重置"),B=_("提交"),D=w(l({__name:"TopicPanel",props:{isEdit:{type:Boolean},classify:{type:Object}},emits:["refreshTable"],setup(e,{expose:l,emit:t}){const d=a(null),c=a(!1),p=e=>{f.confirm("Are you sure you want to close this?").then((()=>{e()})).catch((()=>{}))};function v(){t("refreshTable"),c.value=!1}function h(e){"cancel"!==e?d.value.distribute(!1):c.value=!1}function _(){d.value.distribute(!0)}return l({toggle:e=>{c.value=e}}),(l,a)=>{const t=o("el-button"),f=o("el-drawer");return s(),n("div",E,[r(f,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=e=>c.value=e),direction:"rtl","before-close":p,size:"60%","show-close":!1},{title:u((()=>[m("div",T,[U,e.isEdit?(s(),i(t,{key:0,round:"",onClick:a[0]||(a[0]=e=>{d.value.enableEdit()})},{default:u((()=>[z])),_:1})):y("",!0)])])),default:u((()=>[m("div",null,[r(x,{ref_key:"topicForm",ref:d,classify:e.classify,onCreateSuccess:v},null,8,["classify"])])])),footer:u((()=>[m("div",F,[r(t,{onClick:a[1]||(a[1]=e=>h("cancel"))},{default:u((()=>[j])),_:1}),r(t,{onClick:a[2]||(a[2]=e=>h("reset"))},{default:u((()=>[A])),_:1}),r(t,{type:"primary",onClick:_},{default:u((()=>[B])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-3a51de7d"]]),P={class:"all-topic"},O={style:{display:"flex","align-items":"center"}},R=_("新增"),S=_("查看"),I=_("删除"),L=w(l({__name:"index",setup(l){const t=a(!1),i=a(null),d=a([]);(async()=>{const e=await C();d.value=e.data})();const c=["","danger","info","success","warning"],y=a([]),v=async()=>{const l=await e({url:"/topic/getAllTopic",method:"get"});y.value=l.data};v();const h=()=>{v()},w=a(""),x=b((()=>y.value.filter((e=>!w.value||e.title.toLowerCase().includes(w.value.toLowerCase()))))),E=()=>{t.value=!1,i.value.toggle(!0)},T=()=>{f.confirm("proxy will permanently delete the file. Continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{p({type:"success",message:"Delete completed"})})).catch((()=>{p({type:"info",message:"Delete canceled"})}))};return(e,l)=>{const a=o("el-input"),p=o("el-table-column"),f=o("el-tag"),y=o("el-button"),v=o("el-table");return s(),n("div",P,[r(a,{class:"search",modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),size:"large",placeholder:"Type to search"},null,8,["modelValue"]),r(v,{data:g(x),style:{width:"100%"}},{default:u((()=>[r(p,{type:"index",width:"50"}),r(p,{label:"标题",prop:"title"}),r(p,{label:"分类",prop:"classify_id",width:"150"},{default:u((e=>[m("div",O,[r(f,{class:"ml-2",type:c[Math.random()*c.length|0]},{default:u((()=>{return[_(V((l=e.row.classify_id,(null==(a=d.value.filter((e=>e.id===l)))?void 0:a[0]).title)),1)];var l,a})),_:2},1032,["type"])])])),_:1}),r(p,{label:"作者",prop:"author",width:"100"}),r(p,{label:"公司",prop:"company",width:"100"}),r(p,{label:"浏览",prop:"view",width:"70"}),r(p,{label:"点赞",prop:"like",width:"70"}),r(p,{label:"收藏",prop:"collect",width:"70"}),r(p,{align:"right"},{header:u((()=>[r(y,{round:"",icon:g(k),link:"",type:"primary",onClick:E},{default:u((()=>[R])),_:1},8,["icon"])])),default:u((e=>[r(y,{size:"small",onClick:l=>(e.$index,e.row,t.value=!0,void i.value.toggle(!0))},{default:u((()=>[S])),_:2},1032,["onClick"]),r(y,{size:"small",type:"danger",onClick:l=>(e.$index,e.row,void T())},{default:u((()=>[I])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r(D,{ref_key:"topicPanel",ref:i,isEdit:t.value,classify:d.value,onRefreshTable:h},null,8,["isEdit","classify"])])}}}),[["__scopeId","data-v-83017ff8"]]);export{L as default};
