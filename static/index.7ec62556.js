import{a1 as e,a as l,R as a,r as t,o,f as s,w as i,A as n,C as u,E as r,a2 as d,j as c,e as p,b as f,m,F as y,z as v,D as h,G as _,_ as w,c as b,g,t as V,a3 as k}from"./index.3516f4d4.js";function C(){return e({url:"/classify/getAllClassify",method:"get"})}const x=u("Click to upload"),T=l({__name:"Upload",emits:["uploadSuccess"],setup(e,{emit:l}){const u=a("https://question-bank.ironc.cn/v1/admin/upload"),c=a(""),p=a([]),f=(e,l)=>{},m=e=>{c.value=e.result,l("uploadSuccess",c.value)},y=e=>{},v=(e,l)=>{r.warning(`The limit is 3, you selected ${e.length} files this time, add up to ${e.length+l.length} totally`)},h=e=>d.confirm(`Cancel the transfert of ${e.name} ?`).then((()=>!0),(()=>!1));return(e,l)=>{const a=t("el-button"),r=t("el-upload");return o(),s(r,{"file-list":p.value,"onUpdate:file-list":l[0]||(l[0]=e=>p.value=e),class:"upload-demo",action:u.value,multiple:"","on-preview":y,"on-remove":f,"on-success":m,"before-remove":h,limit:1,"on-exceed":v},{default:i((()=>[p.value.length?n("",!0):(o(),s(a,{key:0,type:"primary"},{default:i((()=>[x])),_:1}))])),_:1},8,["file-list","action"])}}}),E=l({__name:"TopicForm",props:{isEdit:{type:Boolean},classify:{type:Object}},emits:["createSuccess"],setup(l,{expose:n,emit:u}){var r;const d=l,v=a(!0),h=a(),_=c({title:"",classify_id:void 0,company:"",author:"",answer:"",mdurl:""});null==d||d.classify,null==(r=null==d?void 0:d.classify)||r.value;const w=a([]);d.classify?w.value=d.classify:(async()=>{const e=await C();w.value=e.data})();const b=e=>{_.mdurl=e},g=c({title:[{validator:(e,l,a)=>{""===l?a(new Error("Please input the title")):(l.includes("script")&&a(new Error("包含特殊字符")),a())},trigger:"blur"}]}),V=async l=>{await function(l){return e({url:"/topic/create",method:"post",data:l})}(l);u("createSuccess")};return n({distribute:e=>{var l;e?(l=h.value)&&l.validate((e=>{if(!e)return!1;_.title,V(_)})):(e=>{e&&e.resetFields()})(h.value)},enableEdit:()=>{v.value=!1}}),(e,l)=>{const a=t("el-input"),n=t("el-form-item"),u=t("el-option"),r=t("el-select"),d=t("el-form");return o(),s(d,{ref_key:"ruleFormRef",ref:h,model:_,"status-icon":"",rules:g,class:"formData"},{default:i((()=>[p(n,{label:"标题",prop:"title"},{default:i((()=>[p(a,{modelValue:_.title,"onUpdate:modelValue":l[0]||(l[0]=e=>_.title=e),type:"textarea",placeholder:"请输入题目",autocomplete:"off"},null,8,["modelValue"])])),_:1}),p(n,{label:"分类",prop:"classify_id"},{default:i((()=>[p(r,{modelValue:_.classify_id,"onUpdate:modelValue":l[1]||(l[1]=e=>_.classify_id=e),class:"m-2",placeholder:"请选择分类"},{default:i((()=>[(o(!0),f(y,null,m(w.value,(e=>(o(),s(u,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(n,{label:"作者",prop:"author"},{default:i((()=>[p(a,{modelValue:_.author,"onUpdate:modelValue":l[2]||(l[2]=e=>_.author=e),placeholder:"请输入题目作者",autocomplete:"off"},null,8,["modelValue"])])),_:1}),p(n,{label:"公司",prop:"company"},{default:i((()=>[p(a,{modelValue:_.company,"onUpdate:modelValue":l[3]||(l[3]=e=>_.company=e),placeholder:"请输入题目来源",autocomplete:"off"},null,8,["modelValue"])])),_:1}),p(n,{label:"答案",prop:"answer"},{default:i((()=>[p(a,{modelValue:_.answer,"onUpdate:modelValue":l[4]||(l[4]=e=>_.answer=e),placeholder:"请输入题目答案或者上传markdown文件",type:"textarea",autocomplete:"off"},null,8,["modelValue"])])),_:1}),p(T,{onUploadSuccess:b})])),_:1},8,["model","rules"])}}}),U={class:"drawer-wrap"},S={class:"drawer-header"},z=(e=>(h("data-v-3a51de7d"),e=e(),_(),e))((()=>v("h4",null,"TopicPanel",-1))),F=u("开启编辑"),$={style:{flex:"auto"}},j=u("关闭"),A=u("重置"),B=u("提交"),D=w(l({__name:"TopicPanel",props:{isEdit:{type:Boolean},classify:{type:Object}},emits:["refreshTable"],setup(e,{expose:l,emit:u}){const r=a(null),c=a(!1),m=e=>{d.confirm("Are you sure you want to close this?").then((()=>{e()})).catch((()=>{}))};function y(){u("refreshTable"),c.value=!1}function h(e){"cancel"!==e?r.value.distribute(!1):c.value=!1}function _(){r.value.distribute(!0)}return l({toggle:e=>{c.value=e}}),(l,a)=>{const u=t("el-button"),d=t("el-drawer");return o(),f("div",U,[p(d,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=e=>c.value=e),direction:"rtl","before-close":m,size:"60%","show-close":!1},{title:i((()=>[v("div",S,[z,e.isEdit?(o(),s(u,{key:0,round:"",onClick:a[0]||(a[0]=e=>{r.value.enableEdit()})},{default:i((()=>[F])),_:1})):n("",!0)])])),default:i((()=>[v("div",null,[p(E,{ref_key:"topicForm",ref:r,classify:e.classify,onCreateSuccess:y},null,8,["classify"])])])),footer:i((()=>[v("div",$,[p(u,{onClick:a[1]||(a[1]=e=>h("cancel"))},{default:i((()=>[j])),_:1}),p(u,{onClick:a[2]||(a[2]=e=>h("reset"))},{default:i((()=>[A])),_:1}),p(u,{type:"primary",onClick:_},{default:i((()=>[B])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-3a51de7d"]]),P={class:"all-topic"},O={style:{display:"flex","align-items":"center"}},R=u("新增"),I=u("查看"),L=u("删除"),q=w(l({__name:"index",setup(l){const s=a(!1),n=a(null),c=a([]);(async()=>{const e=await C();c.value=e.data})();const m=["","danger","info","success","warning"],y=a([]),h=async()=>{const l=await e({url:"/topic/getAllTopic",method:"get"});y.value=l.data};h();const _=()=>{h()},w=a(""),x=b((()=>y.value.filter((e=>!w.value||e.title.toLowerCase().includes(w.value.toLowerCase()))))),T=()=>{s.value=!1,n.value.toggle(!0)},E=()=>{d.confirm("proxy will permanently delete the file. Continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{r({type:"success",message:"Delete completed"})})).catch((()=>{r({type:"info",message:"Delete canceled"})}))};return(e,l)=>{const a=t("el-input"),r=t("el-table-column"),d=t("el-tag"),y=t("el-button"),h=t("el-table");return o(),f("div",P,[p(a,{class:"search",modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),size:"large",placeholder:"Type to search"},null,8,["modelValue"]),p(h,{data:g(x),style:{width:"100%"}},{default:i((()=>[p(r,{type:"index",width:"50"}),p(r,{label:"标题",prop:"title"}),p(r,{label:"分类",prop:"classify_id",width:"150"},{default:i((e=>[v("div",O,[p(d,{class:"ml-2",type:m[Math.random()*m.length|0]},{default:i((()=>{return[u(V((l=e.row.classify_id,(null==(a=c.value.filter((e=>e.id===l)))?void 0:a[0]).title)),1)];var l,a})),_:2},1032,["type"])])])),_:1}),p(r,{label:"作者",prop:"author",width:"100"}),p(r,{label:"公司",prop:"company",width:"100"}),p(r,{label:"浏览",prop:"view",width:"70"}),p(r,{label:"点赞",prop:"like",width:"70"}),p(r,{label:"收藏",prop:"collect",width:"70"}),p(r,{align:"right"},{header:i((()=>[p(y,{round:"",icon:g(k),link:"",type:"primary",onClick:T},{default:i((()=>[R])),_:1},8,["icon"])])),default:i((e=>[p(y,{size:"small",onClick:l=>(e.$index,e.row,s.value=!0,void n.value.toggle(!0))},{default:i((()=>[I])),_:2},1032,["onClick"]),p(y,{size:"small",type:"danger",onClick:l=>(e.$index,e.row,void E())},{default:i((()=>[L])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),p(D,{ref_key:"topicPanel",ref:n,isEdit:s.value,classify:c.value,onRefreshTable:_},null,8,["isEdit","classify"])])}}}),[["__scopeId","data-v-83017ff8"]]);export{q as default};
